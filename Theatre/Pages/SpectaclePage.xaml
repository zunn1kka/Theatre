<Page x:Class="Theatre.Pages.SpectaclePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
      Title="SpectaclePage">
    <Page.Resources>
        <CollectionViewSource x:Key="FilteredSeats" Source="{Binding Spectacle.Seats}">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="IsBooked" Direction="Ascending" />
                <scm:SortDescription PropertyName="SeatNumber" Direction="Ascending" />
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
    </Page.Resources>
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Изображение спектакля -->
        <Image Source="{Binding Spectacle.Image}" 
               Width="300" Height="200" Grid.Row="0" HorizontalAlignment="Center" />

        <!-- Название спектакля -->
        <TextBlock Text="{Binding Spectacle.Name}" FontSize="24" HorizontalAlignment="Center" Style="{StaticResource ModernTextBlockStyle}" Grid.Row="1" Margin="0,10,0,10" />

        <!-- Список мест -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" Grid.Row="2">
            <ItemsControl ItemsSource="{Binding Source={StaticResource FilteredSeats}}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="Gray" BorderThickness="1" Margin="5" Padding="10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding SeatNumber}" FontSize="16" VerticalAlignment="Center" />
                                <TextBlock Text="{Binding Price, StringFormat='Цена: {0:C}'}" FontSize="16" VerticalAlignment="Center" Margin="10,0,0,0" />
                                <Button Content="Забронировать" Style="{StaticResource ModernButtonStyle}" Command="{Binding DataContext.BookSeatCommand, RelativeSource={RelativeSource AncestorType=Page}}" 
                                        CommandParameter="{Binding}" Margin="10,0,0,0" />
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Кнопка возврата -->
        <Button Content="Назад" Grid.Row="3" Width="200" HorizontalAlignment="Left" Margin="0,10,0,0" Click="BackButton_Click" Style="{StaticResource ModernButtonStyle}"/>
    </Grid>
</Page>